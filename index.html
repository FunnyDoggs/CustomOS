<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OS Emulator</title>
</head>
<body>
  <pre id="output"></pre>
  <input type="text" id="cliInput" placeholder="Type a command">

  <script>
    class CPU {
      constructor() {
        this.registers = new Array(8).fill(0);
        this.memory = new Array(256).fill(0);
        this.programCounter = 0;
        this.fileSystem = new FileSystem();
      }

      execute(instruction) {
        if (instruction === 'PRINT') {
          const data = this.memory[this.programCounter + 1];
          this.print(data);
        } else if (instruction === 'ADD') {
          const operand1 = this.memory[this.programCounter + 1];
          const operand2 = this.memory[this.programCounter + 2];
          this.add(operand1, operand2);
        } else if (instruction === 'READ_FILE') {
          const fileName = this.memory[this.programCounter + 1];
          this.readFile(fileName);
        }

        this.programCounter += 2;
      }

      print(data) {
        const outputElement = document.getElementById('output');
        outputElement.textContent += String.fromCharCode(data);
      }

      add(operand1, operand2) {
        this.registers[0] = operand1 + operand2;
      }

      readFile(fileName) {
        const content = this.fileSystem.readFile(fileName);
        this.print(content);
      }
    }

    class OS {
      constructor(cpu) {
        this.cpu = cpu;
        this.program = [
          'PRINT', 65,
          'ADD', 10, 20,
          'READ_FILE', 'file.txt'
        ];
      }

      loadProgram() {
        for (let i = 0; i < this.program.length; i++) {
          this.cpu.memory[i] = this.program[i];
        }
      }

      run() {
        while (this.cpu.programCounter < this.cpu.memory.length) {
          const instruction = this.cpu.memory[this.cpu.programCounter];
          this.cpu.execute(instruction);
        }
      }
    }

    class FileSystem {
      constructor() {
        this.storage = window.localStorage;
      }

      readFile(fileName) {
        return this.storage.getItem(fileName) || 'File not found';
      }

      writeFile(fileName, content) {
        this.storage.setItem(fileName, content);
      }
    }

    const cpu = new CPU();
    const os = new OS(cpu);

    os.loadProgram();
    os.run();

    const cliInput = document.getElementById('cliInput');
    cliInput.addEventListener('keydown', function (event) {
      if (event.key === 'Enter') {
        const command = cliInput.value.trim();
        handleCommand(command);
        cliInput.value = '';
      }
    });

    function handleCommand(command) {
      const args = command.split(' ');
      const commandName = args[0].toUpperCase();

      switch (commandName) {
        case 'WRITE_FILE':
          const fileName = args[1];
          const content = args.slice(2).join(' ');
          cpu.fileSystem.writeFile(fileName, content);
          break;
        case 'LIST_FILES':
          listFiles();
          break;
        case 'CLEAR':
          clearOutput();
          break;
        default:
          // Handle other commands as needed
          break;
      }
    }

    function listFiles() {
      const outputElement = document.getElementById('output');
      outputElement.textContent += 'Files in Storage:\n';

      for (let i = 0; i < cpu.fileSystem.storage.length; i++) {
        const fileName = cpu.fileSystem.storage.key(i);
        outputElement.textContent += `- ${fileName}\n`;
      }
    }

    function clearOutput() {
      const outputElement = document.getElementById('output');
      outputElement.textContent = '';
    }
  </script>
</body>
</html>
